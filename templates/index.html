<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
  <title>BOA USSD Test Runner</title>

</head>
<body>
  <header>
    <img src="{{ url_for('static', filename='/Images/BOA_Logo.png') }}"
         alt="BOA Logo">
  </header>

  <div class="container">
    <h1>USSD Test Runner</h1>
    <form id="testForm">
      <label for="device_id">Device ID</label>
      <input type="text" id="device_id" name="device_id" required>

      <label for="android_version">Android Version</label>
      <input type="text" id="android_version" name="android_version" required>

      <label for="pin">Pin</label>
      <input type="password" id="pin" name="pin" required>

      <label for="account_number">Receiver Account</label>
      <input type="text" id="account_number" name="account_number" required>

      <label for="amount">Amount</label>
      <input type="number" id="amount" name="amount" required>

      <label for="Phone">Phone</label>
      <input type="phone" id="phone_number" name="phone_number" required>


      <button type="submit">Run Test</button>
    </form>

    <!-- Results injected here -->
    <div id="resultDisplay" style="display:none;">
      <div class="result-box" id="resultBox"></div>
      <div class="report-path">
        <strong>Report Path:</strong>
        <span id="reportPath"></span>
      </div>
    </div>
  </div>

  <div class="loading-overlay" id="loadingOverlay">
    <div class="spinner"></div>
  </div>

  <script>
    const form = document.getElementById('testForm');
    const outBox = document.getElementById('resultBox');
    const overlay = document.getElementById('loadingOverlay');
    const outDiv  = document.getElementById('resultDisplay');
    const runBtn  = form.querySelector('button[type="submit"]');
    const pathEl  = document.getElementById('reportPath');
  
    form.addEventListener('submit', e => {
      e.preventDefault();
      outBox.innerHTML = '';
      runBtn.disabled = true;
      overlay.style.display = 'flex';
      outDiv.style.display  = 'none';
      outBox.textContent    = ''; 
      pathEl.textContent    = '';
  
      const data = {
        device_id: form.device_id.value,
        android_version: form.android_version.value,
        account_number: form.account_number.value,
        pin: form.pin.value,
        amount: form.amount.value,
        phone_number: form.phone_number.value
      };
  
      fetch('/run-test', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      })
      .then(() => {
        const eventSource = new EventSource('/stream-logs');
        eventSource.onmessage = function(event) {
          outDiv.style.display = 'block';
          outBox.innerHTML += event.data + '<br>';
          outBox.scrollTop = outBox.scrollHeight;
        };
  
        eventSource.onerror = function() {
          eventSource.close();
          runBtn.disabled = false;
        };
      })
      .catch(err => {
        outBox.textContent = 'Error: ' + err;
        runBtn.disabled = false;
        overlay.style.display = 'none';
        pathEl.textContent   = '';
        outDiv.style.display  = 'block';
      })
      .finally(() => {
      runBtn.disabled = false;
      });
    });
  </script>

<script>



</script>
  
</body>
</html>
